<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Select Your Seat</title>
  <style>
    body {
      font-family: Verdana, Geneva, Tahoma, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 20px;
      color: #fff;
      background-color: #0a3c5f;
      text-align: center;
      padding: 10px;
      border-radius: 10px;
    }
    
    h2 {
      text-align: center;
      color: #0a3c5f;
    }
    
    .flight-details {
      background-color: white;
      border: 4px solid #0a3c5f;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .flight-info {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    
    .flight-info div {
      flex-basis: 48%;
      margin-bottom: 10px;
    }
    
    .seat-map-container {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border: 4px solid #0a3c5f;
    }
    
    .seat-map {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .plane-front {
      width: 100%;
      background-color: #e0e0e0;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      font-weight: bold;
      margin-bottom: 20px;
    }
    
    .seat-legend {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
    }
    
    .legend-color {
      width: 24px;
      height: 24px;
      margin-right: 8px;
      border-radius: 4px;
    }
    
    .seat-rows {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .seat-row {
      display: flex;
      align-items: center;
    }
    
    .row-number {
      width: 30px;
      text-align: center;
      font-weight: bold;
      color: #666;
    }
    
    .seat {
      width: 45px;
      height: 45px;
      margin: 0 5px;
      border-radius: 8px 8px 0 0;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid;
      font-weight: bold;
    }
    
    .first-class {
      border-color: #9c27b0;
      background-color: white;
    }
    
    .business {
      border-color: #2196f3;
      background-color: white;
    }
    
    .economy-plus {
      border-color: #4caf50;
      background-color: white;
    }
    
    .economy {
      border-color: #9e9e9e;
      background-color: white;
    }
    
    .reserved {
      background-color: #9e9e9e;
      color: white;
      cursor: not-allowed;
      border-color: #9e9e9e;
    }
    
    .selected {
      background-color: #2196f3;
      color: white;
      border-color: #2196f3;
    }
    
    .seat:hover:not(.reserved):not(.selected) {
      background-color: #e3f2fd;
    }
    
    .aisle {
      width: 20px;
    }
    
    .seat-selection {
      margin-top: 30px;
      padding: 20px;
      background-color: #e3f2fd;
      border-radius: 10px;
      border: 1px solid #bbdefb;
      text-align: center;
    }
    
    .personal-info-container, .payment-container {
      max-width: 1000px;
      margin: 30px auto;
      background-color: white;
      border-radius: 10px;
      padding: 50px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border: 4px solid #0a3c5f;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
    }
    
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }
    
    .form-row {
      display: flex;
      gap: 40px;
    }
    
    .form-row .form-group {
      flex: 1;
    }
    
    button {
      background-color: #0a3c5f;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      margin-top: 10px;
      transition: background-color 0.3s;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    
    button:hover {
      background-color: #072a43;
    }
    
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    
    .confirmation {
      text-align: center;
      background-color: #e8f5e9;
      border: 1px solid #c8e6c9;
      padding: 20px;
      border-radius: 10px;
      margin-top: 30px;
      color: #2e7d32;
    }
    
    .hidden {
      display: none;
    }
    
    .check-icon {
      font-size: 48px;
      color: #4caf50;
      margin-bottom: 10px;
    }
    
    .back-button {
      background-color: #757575;
      margin-top: 10px;
    }
    
    .back-button:hover {
      background-color: #616161;
    }
    
    @media (max-width: 768px) {
      .flight-info div {
        flex-basis: 100%;
      }
      
      .form-row {
        flex-direction: column;
        gap: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Book now!</h1>
    
    <div class="flight-details" id="flight-details">
      <!-- Flight details will be populated by JavaScript -->
    </div>
    
    <div id="seat-map-section">
      <div class="seat-map-container">
        <div class="seat-map">
          <div class="plane-front">Select seat</div>
          
          <div class="seat-legend">
            <div class="legend-item">
              <div class="legend-color" style="border: 2px solid #9c27b0; background-color: white;"></div>
              <span>First Class ($200)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="border: 2px solid #2196f3; background-color: white;"></div>
              <span>Business ($150)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="border: 2px solid #4caf50; background-color: white;"></div>
              <span>Economy Plus ($100)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="border: 2px solid #9e9e9e; background-color: white;"></div>
              <span>Economy ($50)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #9e9e9e;"></div>
              <span>Reserved</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #2196f3;"></div>
              <span>Selected</span>
            </div>
          </div>
          
          <div class="seat-rows" id="seat-rows">
            <!-- Seat rows will be generated by JavaScript -->
          </div>
        </div>
      </div>
      
      <div id="seat-selection" class="seat-selection hidden">
        <p><strong>Selected Seat:</strong> <span id="selected-seat-id"></span> (<span id="selected-seat-class"></span>)</p>
        <p><strong>Seat Price:</strong> $<span id="selected-seat-price"></span></p>
        <button id="proceed-to-personal-info">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          Proceed to Personal Information
        </button>
      </div>
    </div>
    
    <!-- NEW SECTION: Personal Information -->
    <div id="personal-info-section" class="personal-info-container hidden">
      <h2>Personal Information</h2>
      
      <div class="form-group">
        <label>Selected Seat</label>
        <div style="padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
          <span id="personal-info-seat-id"></span> - $<span id="personal-info-seat-price"></span>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="first-name">First Name*</label>
          <input type="text" id="first-name" placeholder="John" required>
        </div>
        
        <div class="form-group">
          <label for="last-name">Last Name*</label>
          <input type="text" id="last-name" placeholder="Doe" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="date-of-birth">Date of Birth*</label>
          <input type="date" id="date-of-birth" required>
        </div>
        
        <div class="form-group">
          <label for="gender">Gender</label>
          <select id="gender">
            <option value="">Select</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
            <option value="prefer-not">Prefer not to say</option>
          </select>
        </div>
      </div>
      
      <div class="form-group">
        <label for="email">Email Address*</label>
        <input type="email" id="email" placeholder="john.doe@example.com" required>
      </div>
      
      <div class="form-group">
        <label for="phone">Phone Number*</label>
        <input type="tel" id="phone" placeholder="+1 (123) 456-7890" required>
      </div>
      
      <div class="form-group">
        <label for="address">Address</label>
        <input type="text" id="address" placeholder="123 Main St">
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="city">City</label>
          <input type="text" id="city" placeholder="New York">
        </div>
        
        <div class="form-group">
          <label for="postal-code">Postal Code</label>
          <input type="text" id="postal-code" placeholder="10001">
        </div>
      </div>
      
      <div class="form-group">
        <label for="country">Country*</label>
        <select id="country" required>
          <option value="">Select Country</option>
          <option value="US">United States</option>
          <option value="CA">Canada</option>
          <option value="UK">United Kingdom</option>
          <option value="AU">Australia</option>
          <option value="PH">Philippines</option>
          <!-- More countries would be added here -->
        </select>
      </div>
      
      <div class="form-group">
        <label for="passport">Passport/ID Number*</label>
        <input type="text" id="passport" placeholder="AB1234567" required>
      </div>
      
      <button id="proceed-to-payment" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
          <line x1="1" y1="10" x2="23" y2="10"></line>
        </svg>
        Proceed to Payment
      </button>
      
      <button id="back-to-seats-from-personal-info" class="back-button">Back to Seat Selection</button>
    </div>
    
    <div id="payment-section" class="payment-container hidden">
      <h2>Complete Payment</h2>
      
      <div class="form-group">
        <label>Selected Seat</label>
        <div style="padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
          <span id="payment-seat-id"></span> - $<span id="payment-seat-price"></span>
        </div>
      </div>
      
      <div class="form-group">
        <label>Passenger</label>
        <div style="padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
          <span id="payment-passenger-name"></span>
        </div>
      </div>
      
      <div class="form-group">
        <label for="card-number">Card Number*</label>
        <input type="text" id="card-number" placeholder="1234 5678 9012 3456" required>
      </div>
      
      <div class="form-group">
        <label for="card-name">Cardholder Name*</label>
        <input type="text" id="card-name" placeholder="Juan Dela Cruz" required>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="expiry">Expiry Date*</label>
          <input type="text" id="expiry" placeholder="MM/YY" required>
        </div>
        
        <div class="form-group">
          <label for="cvv">CVV*</label>
          <input type="text" id="cvv" placeholder="123" required>
        </div>
      </div>
      
      <button id="pay-button" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
          <line x1="1" y1="10" x2="23" y2="10"></line>
        </svg>
        Pay Now $<span id="payment-total"></span>
      </button>
      
      <button id="back-to-personal-info" class="back-button">Back to Personal Information</button>
    </div>
    
    <div id="confirmation-section" class="confirmation hidden">
      <div class="check-icon">✓</div>
      <h2>Booking Confirmed!</h2>
      <p>Your seat <span id="confirmation-seat"></span> has been successfully reserved.</p>
      <p>A confirmation has been sent to <span id="confirmation-email"></span>.</p>
      <p>Passenger: <span id="confirmation-passenger"></span></p>
      <p>Flight: <span id="confirmation-flight"></span></p>
      <p>Total paid: $<span id="confirmation-amount"></span></p>
      <button id="view-receipt">View Receipt</button>
      <button id="back-to-home">Return to Homepage</button>
    </div>
  </div>
  
  <script>
    // Get selected flight data from localStorage
    const selectedFlight = JSON.parse(localStorage.getItem("selectedFlight"));
    
    // If no flight data, redirect back to flight selection
    if (!selectedFlight) {
      alert("No flight selected. Redirecting to flight search.");
      window.location.href = "index.html";
    }
    
    // Display flight details
    const flightDetailsContainer = document.getElementById("flight-details");
    flightDetailsContainer.innerHTML = `
      <h2>${selectedFlight.from} → ${selectedFlight.to}</h2>
      <div class="flight-info">
        <div><strong>Departure Date:</strong> ${selectedFlight.departure}</div>
        ${selectedFlight.return ? `<div><strong>Return Date:</strong> ${selectedFlight.return}</div>` : ''}
        <div><strong>Cabin Class:</strong> ${selectedFlight.cabin.charAt(0).toUpperCase() + selectedFlight.cabin.slice(1)}</div>
        <div><strong>Time:</strong> ${selectedFlight.time || 'N/A'}</div>
        <div><strong>Base Price:</strong> ${selectedFlight.price}</div>
        <div><strong>Flight Number:</strong> ${selectedFlight.flightNumber || 'N/A'}</div>
        <div><strong>Arline:</strong> ${selectedFlight.airline || 'N/A'}</div>
      </div>
    `;
    
    // Seat map configuration
    const rows = 10;
    const seatsPerRow = 6;
    const aisleAfter = 3; // Aisle after seat C
    
    // Reserved seats (sample data)
    const reservedSeats = ['1A', '1B', '3D', '5F', '7C', '9E', '10A'];
    
    // Seat prices based on class
    const seatPrices = {
      // First class (rows 1-2)
      '1': 200, '2': 200,
      // Business class (rows 3-5)
      '3': 150, '4': 150, '5': 150,
      // Economy plus (rows 6-7)
      '6': 100, '7': 100,
      // Economy (rows 8-10)
      '8': 50, '9': 50, '10': 50
    };
    
    // Get seat class based on row number
    function getSeatClass(rowNum) {
      if (rowNum <= 2) return 'first-class';
      if (rowNum <= 5) return 'business';
      if (rowNum <= 7) return 'economy-plus';
      return 'economy';
    }
    
    // Get seat class name for display
    function getSeatClassName(rowNum) {
      if (rowNum <= 2) return 'First Class';
      if (rowNum <= 5) return 'Business';
      if (rowNum <= 7) return 'Economy Plus';
      return 'Economy';
    }
    
    // Get seat price based on row number
    function getSeatPrice(seat) {
      if (!seat) return null;
      const rowNum = seat.slice(0, -1);
      return seatPrices[rowNum];
    }
    
    // Variables to track seat selection and payment state
    let selectedSeat = null;
    let paymentComplete = false;
    let personalInfo = {};
    
    // Generate booking reference number
    function generateBookingReference() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let reference = '';
      for (let i = 0; i < 6; i++) {
        reference += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return reference;
    }
    
    // Generate seat map
    const seatRowsContainer = document.getElementById('seat-rows');
    
    for (let row = 1; row <= rows; row++) {
      const rowElement = document.createElement('div');
      rowElement.className = 'seat-row';
      
      // Add row number
      const rowNumberElement = document.createElement('div');
      rowNumberElement.className = 'row-number';
      rowNumberElement.textContent = row;
      rowElement.appendChild(rowNumberElement);
      
      for (let seatPos = 0; seatPos < seatsPerRow; seatPos++) {
        // Add aisle space
        if (seatPos === aisleAfter) {
          const aisleElement = document.createElement('div');
          aisleElement.className = 'aisle';
          rowElement.appendChild(aisleElement);
        }
        
        // Convert seat position to letter (0=A, 1=B, etc)
        const seatLetter = String.fromCharCode(65 + seatPos);
        const seatId = `${row}${seatLetter}`;
        const isReserved = reservedSeats.includes(seatId);
        
        const seatElement = document.createElement('div');
        seatElement.className = `seat ${getSeatClass(row)} ${isReserved ? 'reserved' : ''}`;
        seatElement.textContent = seatId;
        seatElement.dataset.seatId = seatId;
        
        if (!isReserved) {
          seatElement.addEventListener('click', function() {
            // Remove selected class from previously selected seat
            if (selectedSeat) {
              document.querySelector(`.seat[data-seat-id="${selectedSeat}"]`).classList.remove('selected');
            }
            
            // Apply selected class to current seat
            this.classList.add('selected');
            selectedSeat = seatId;
            
            // Update seat selection display
            document.getElementById('selected-seat-id').textContent = seatId;
            document.getElementById('selected-seat-class').textContent = getSeatClassName(row);
            document.getElementById('selected-seat-price').textContent = getSeatPrice(seatId);
            
            // Show seat selection panel
            document.getElementById('seat-selection').classList.remove('hidden');
          });
        }
        
        rowElement.appendChild(seatElement);
      }
      
      seatRowsContainer.appendChild(rowElement);
    }
    
    // Personal information form validation
    const requiredPersonalFields = [
      'first-name', 'last-name', 'date-of-birth', 'email', 'phone', 'country', 'passport'
    ];
    
    function validatePersonalInfo() {
      const isValid = requiredPersonalFields.every(fieldId => {
        const field = document.getElementById(fieldId);
        return field && field.value.trim() !== '';
      });
      
      document.getElementById('proceed-to-payment').disabled = !isValid;
    }
    
    // Add event listeners to all required personal info fields
    requiredPersonalFields.forEach(fieldId => {
      const field = document.getElementById(fieldId);
      if (field) {
        field.addEventListener('input', validatePersonalInfo);
      }
    });
    
    // Event listeners for buttons
    document.getElementById('proceed-to-personal-info').addEventListener('click', function() {
      // Update personal info section with selected seat info
      document.getElementById('personal-info-seat-id').textContent = selectedSeat;
      document.getElementById('personal-info-seat-price').textContent = getSeatPrice(selectedSeat);
      
      // Hide seat map section and show personal info section
      document.getElementById('seat-map-section').classList.add('hidden');
      document.getElementById('personal-info-section').classList.remove('hidden');
    });
    
    document.getElementById('back-to-seats-from-personal-info').addEventListener('click', function() {
      // Hide personal info section and show seat map section
      document.getElementById('personal-info-section').classList.add('hidden');
      document.getElementById('seat-map-section').classList.remove('hidden');
    });
    
    document.getElementById('proceed-to-payment').addEventListener('click', function() {
      // Collect personal information
      personalInfo = {
        firstName: document.getElementById('first-name').value,
        lastName: document.getElementById('last-name').value,
        fullName: `${document.getElementById('first-name').value} ${document.getElementById('last-name').value}`,
        dob: document.getElementById('date-of-birth').value,
        gender: document.getElementById('gender').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        city: document.getElementById('city').value,
        postalCode: document.getElementById('postal-code').value,
        country: document.getElementById('country').value,
        passport: document.getElementById('passport').value
      };
      
      // Update payment section with selected seat info and passenger name
      document.getElementById('payment-seat-id').textContent = selectedSeat;
      document.getElementById('payment-seat-price').textContent = getSeatPrice(selectedSeat);
      document.getElementById('payment-passenger-name').textContent = personalInfo.fullName;
      document.getElementById('payment-total').textContent = getSeatPrice(selectedSeat) + selectedFlight.price;
      
      // Pre-fill cardholder name if available
      document.getElementById('card-name').value = personalInfo.fullName;
      
      // Hide personal info section and show payment section
      document.getElementById('personal-info-section').classList.add('hidden');
      document.getElementById('payment-section').classList.remove('hidden');
    });
    
    document.getElementById('back-to-personal-info').addEventListener('click', function() {
      // Hide payment section and show personal info section
      document.getElementById('payment-section').classList.add('hidden');
      document.getElementById('personal-info-section').classList.remove('hidden');
    });
    
    // Form validation for payment
    const cardNumberInput = document.getElementById('card-number');
    const cardNameInput = document.getElementById('card-name');
    const expiryInput = document.getElementById('expiry');
    const cvvInput = document.getElementById('cvv');
    const payButton = document.getElementById('pay-button');
    
    function validatePayment() {
      const isValid = 
        cardNumberInput.value.trim() !== '' && 
        cardNameInput.value.trim() !== '' && 
        expiryInput.value.trim() !== '' && 
        cvvInput.value.trim() !== '';
      
      payButton.disabled = !isValid;
    }
    
    cardNumberInput.addEventListener('input', validatePayment);
    cardNameInput.addEventListener('input', validatePayment);
    expiryInput.addEventListener('input', validatePayment);
    cvvInput.addEventListener('input', validatePayment);
    
    payButton.addEventListener('click', function() {
      // Generate booking reference
      const bookingReference = generateBookingReference();
      
      // Get current date and time
      const now = new Date();
      const bookingDateTime = now.toLocaleString();
      
      // Create booking object that combines flight, personal info and seat data
      const booking = {
        reference: bookingReference,
        flight: selectedFlight,
        seat: selectedSeat,
        seatClass: getSeatClassName(selectedSeat.slice(0, -1)),
        seatPrice: getSeatPrice(selectedSeat),
        basePrice: selectedFlight.price,
        totalPrice: getSeatPrice(selectedSeat) + selectedFlight.price,
        passenger: personalInfo,
        paymentMethod: 'Credit Card',
        cardLastFour: cardNumberInput.value.slice(-4),
        bookingDate: bookingDateTime
      };
      
      // Save booking to localStorage
      localStorage.setItem('completedBooking', JSON.stringify(booking));
      
      // Update confirmation details
      document.getElementById('confirmation-seat').textContent = selectedSeat;
      document.getElementById('confirmation-email').textContent = personalInfo.email;
      document.getElementById('confirmation-passenger').textContent = personalInfo.fullName;
      document.getElementById('confirmation-flight').textContent = `${selectedFlight.from} to ${selectedFlight.to}`;
      document.getElementById('confirmation-amount').textContent = booking.totalPrice;
      
      // Hide payment section and show confirmation
      document.getElementById('payment-section').classList.add('hidden');
      document.getElementById('confirmation-section').classList.remove('hidden');
    });
    
    // Add event listener for view receipt button
    document.getElementById('view-receipt').addEventListener('click', function() {
      window.location.href = 'receipt.html';
    });
    
    document.getElementById('back-to-home').addEventListener('click', function() {
      window.location.href = 'flight.html';
    });
  </script>
</body>
</html>